<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>药房发药</title>
</head>
<body>
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 药房管理 <span class="c-gray en">&gt;</span> 药房发药 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>

<div class="page-container" id="wrap">
	<form  class="form form-horizontal" id="form-member-add">
	<div class="row cl">
		<label class="form-label col-xs-1 col-sm-1"><span class="c-red">*</span>病历号：</label>
		<div class="formControls col-xs-2 col-sm-2">
			<input type="text" class="input-text" v-model="caseNumber" value="" placeholder="" id="username" name="username">
		</div>

		<div class="formControls col-xs-1 col-sm-1" style="margin-left: 50px;">
			<button name="" id="" @click="checkNumber" class="btn btn-success" type="button" ><i class="Hui-iconfont">&#xe665;</i> 搜索</button>
		</div>
	</div>
	</form>
	<div class="mt-20" style="margin-top: 50px;">
		<table class="table table-border table-bordered table-bg table-hover table-responsive">
			<thead>
				<tr class="text-c">
					<th width="25"></th>
					<th width="80">药品名称</th>
					<th width="120">单价</th>
					<th width="80">数量</th>
					<th width="80">药品状态</th>
					<th width="60">开立医生</th>
					<th width="60">处方名称</th>
					<th width="75">开立时间</th>
			
				</tr>
			</thead>
			<tbody>
				<tr class="text-c" v-for="item in prescriptiondetailedList">
					<td><input type="checkbox" value="" name="" v-model="item.chooseState" @change="drugAdd(item)"></td>
					<td v-text="item.drugsID.drugsName"></td>
					<td v-text="item.drugsID.drugsPrice"></td>
					<td v-text="item.amount"></td>
					<td v-text="item.state"></td>
					<td v-text="item.prescriptionID.registID.userID.realName"></td>
					<td v-text="item.prescriptionID.prescriptionName"></td>
					<td v-text="item.prescriptionID.prescriptionTime"></td>

				</tr>
			</tbody>
		</table>
	</div>
		<button name="" id="" class="btn btn-danger" @click="medicine"  type="button" style="margin-top: 10px; width: 100px;">发药</button>
</div>


<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script> 
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->
<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script> 
<script type="text/javascript" src="lib/datatables/1.10.0/jquery.dataTables.min.js"></script> 
<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
	function article_edit(title,url){
			layer.open({
				type: 2,
				title: title,
				content: url,
			    area: ['800px', '400px'],  //弹出层页面比例
			});
	}

</script>
<script>
	var app =new Vue({
			el:"#wrap",
			data:{
				caseNumber:null,
				prescriptiondetailedList:[], //查询的缴费项目列表
				selectprescriptiondList:[]
			},
			methods:{
				//根据病历号搜索挂号信息,赋值挂号对象给register
				checkNumber(){
					//axois调用预留
					this.selectprescriptiondList=[];
					var _this =this;
					axios.get("http://localhost:8080/toll/findAll?caseNumber="+this.caseNumber).then(res=>{
							if(res.data.prescriptiondetaileds.length==0){
								alert("当前患者未有开立收费项目");
							}else{
								_this.prescriptiondetailedList = res.data.prescriptiondetaileds;
							}
							
					});
				},
				//选择开立的项目
				drugAdd(item){
					if(item.chooseState){
						this.selectprescriptiondList.push(item);
					}else{
						var temp = this.selectprescriptiondList.indexOf(item);
						this.selectprescriptiondList.splice(temp,1);
					}
				},
				//处理发药业务
				medicine(){
					if(this.selectprescriptiondList.length==0){
						alert("请选择要发药的项目");
					}else{
						if(window.confirm("确定要进行发药吗？")){
						//更改患者处方详细列表状态
						for(var i=0;i<this.selectprescriptiondList.length;i++){
							if(this.selectprescriptiondList[i].state==4){
								alert("此项目已经完成发药操作，无法继续发药");
								return;
							}
							this.selectprescriptiondList[i].state=4;	
						}
						axios.post("http://localhost:8080/toll/save3",this.selectprescriptiondList).then(res=>{
							alert("提示：发药成功！");
						});	
						}
					}
					
				}
			}
			})	
</script>
</body>
</html>