<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
<link rel="stylesheet" href="lib/zTree/v3/css/zTreeStyle/zTreeStyle.css" type="text/css">
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<style type="text/css">
	.table1 tbody {
	        display:block;
	        max-height:300px;
	        overflow-y:scroll;
	    }
	.table1 thead, tbody tr {
	       display:table;
			width:100%;
	       table-layout:fixed;
	 }
</style>
<title>医生诊疗</title>
</head>
<body>
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 门诊医生 <span class="c-gray en">&gt;</span> 门诊病历 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
<table class="table" id="wrap">
	<tr>
		<td width="300" class="va-t">
			<div style="margin-top: 10px;">
				<label style="font-size: 15px;"><strong>患者选择</strong></label>
			</div>
			<div style="margin-bottom: 10px;">
				<label>患者名：</label>
				<input type="text" name="" id="" v-model="checkName"  placeholder="请输入查询患者姓名" style="width:150px" class="input-text">
				<button name="" id="" class="btn btn-success" type="button" @click="check" ><i class="Hui-iconfont">&#xe665;</i> 搜索</button>
			</div>
			<div style="height: 300px;">
			<table class="table table-border table-bordered table-bg table-hover table-sort table-responsive table1" >
				<thead>
					<tr >
						<th>未诊患者：</th>
					</tr>                      
				</thead>
				<tbody>
					<tr v-for="item in registerList" v-if="item.visitState==1">
						<td @click="selectPatient(item)" ><span v-text="item.caseNumber"></span><span style="padding-left: 80px; width: 100px;" v-text="item.realName"></span><span style="float: right; padding-right: 40px;" v-text="item.age"></span></td>
					</tr>
				
				</tbody>
			</table>
			</div>
			<div style="height: 300px;">
			<table class="table table-border table-bordered table-bg table-hover table-sort table-responsive table1" style="margin-top: 50px;">
				<thead>
					<tr >
						<th width="80">已诊患者：</th>
					</tr>
				</thead>
				<tbody>
					<tr v-for="item in registerList" v-if="item.visitState==3 || item.visitState==2">
						<td  @click="selectPatient(item)"><span v-text="item.caseNumber"></span><span style="padding-left: 80px; width: 100px;" v-text="item.realName"></span><span style="float: right; padding-right: 40px;" v-text="item.age"></span></td>
					</tr>
				</tbody>
			</table>
			</div>
		</td>
		<td class="va-t">
			<iframe ID="testIframe" Name="testIframe" FRAMEBORDER=0 SCROLLING=AUTO width=100%  height=900px SRC="system-base.html">
				
			</iframe>
		</td>
		
	</tr>
</table>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script>
		//localStorage储存选定用户信息
		var app =new Vue({ 
			el:"#wrap",
			data:{	
				checkName:"",
				docUser:{id:1},//登录从loclaStorage取对象
				register:{},
				registerList:[]
			},
			methods:{
				check(){
					if(this.checkName==""){
						this.initMethod();
					}else{
						var _this =this;
						axios.post("http://localhost:8080/visit/check?docID="+this.docUser.id+"&checkName="+this.checkName).then(res=>{
							_this.registerList=res.data.registerList;
						});	
					}
					
				},
				initMethod(){
					var _this =this;
					axios.post("http://localhost:8080/visit/init?docID="+this.docUser.id).then(res=>{
						_this.registerList=res.data.registerList;
					});
				},
				selectPatient(item){
					this.register=item;
					//将选定的挂号信息存储在localStorage中
					localStorage.setItem("register",JSON.stringify(this.register));
					document.querySelector('iframe').contentWindow.location.reload();
				}
			},
			created(){
				var loginID = localStorage.getItem("loginID");
				if(loginID){
					  this.docUser =JSON.parse(loginID);
				}else{
					 alert("您尚未登录，点击确定跳转到登录页面");
					 location.href="login.html";
				}
				this.initMethod();
			}
			})
	</script>
</body>
</html>